<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0b66c3">
    <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="woodicon.png">
  <link rel="apple-touch-icon" href="woodicon.png">
  <title>Wood App Form</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    section { margin-bottom: 18px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    input[type="text"], input[type="email"], input[type="number"], input[type="date"], textarea, select { width: 98%; padding: 6px; box-sizing: border-box; }
    .materials-table th, .materials-table td { border: 1px solid #ddd; }
    .actions { margin-top: 12px; }
    .result { white-space: pre-wrap; background:#f7f7f7; padding:10px; border:1px solid #e1e1e1; }
    .floor-pad { font-weight: 700; font-size: 1.1em; }
  </style>
</head>
<body>
  <h1>Wood App Form</h1>
  <div class="header-buttons" style="text-align:center; margin-bottom:8px;">
    <button id="themeToggle" type="button">üåì Toggle Dark/Light</button>
    <button id="infoBtn" type="button" style="margin-left:8px;">‚ÑπÔ∏è App Help</button>
    <button id="guideBtn" type="button" style="margin-left:8px;">üìñ Wood Heat Guide</button>
    <span id="versionDisplay" style="margin-left:16px; font-size:0.85em; color:#666;"></span>
  </div>

  <form id="woodAppForm">
    <section>
        <label>Policy # or Name:<br><input type="text" name="policy"></label><br>
        <label>Survey date:<br><input type="date" name="survey_date"></label><br>
        <label>Completed by:<br>
            <select name="completed_by">
              <option value="Gary Bryson">Gary Bryson</option>
              <option value="Elliot Olscamp">Elliot Olscamp</option>
            <option value="Agent">Agent</option>
            </select>
        </label>
    </section>

    <div id="appliancesContainer">
      <div class="appliance-section" data-appliance-num="1">
        <section>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <h2 class="appliance-heading">Appliance</h2>
            <button type="button" class="delete-appliance-btn" style="display:none; padding:6px 12px; background:#d32f2f; color:white; border:none; border-radius:4px; cursor:pointer;">Delete App</button>
          </div>
      <table class="materials-table" id="materialsTable">
        <thead>
          <tr>
            <th>Type</th>
            <th>Manufacturer</th>
            <th>Model</th>
            <th>Installed By</th>
            <th>Chimney Code</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-label="Type"><select id="type" name="type">
              <option value="">Select</option>
              <option value="Stove">S - Stove</option>
                <option value="Kitchen Wood Range">R - Kitchen wood range</option>
                <option value="Insert">I - Insert</option>
                <option value="Furnace">F - Furnace</option>
                <option value="Boiler">B - Boiler</option>
                <option value="Factory Built Fireplace">A - Factory built fireplace</option>
                <option value="Pellet Stove/Insert">P - Pellet stove/insert</option>
                <option value="Hearth">H - Hearth mount</option>
                <option value="Outdoor Wood Boiler">OB - Outdoor wood boiler</option>
                <option value="Masonry Fireplace">FP - Masonry fireplace</option>
              </select>
            </td>
            <td data-label="Manufacturer"><input type="text" name="make" autocomplete="off"></td>
            <td data-label="Model"><input type="text" name="model"></td>
            <td data-label="Installed By"><input type="text" name="installed_by"></td>
            <td data-label="Chimney Code">
              <div style="display:flex;gap:6px;align-items:center;">
                <select name="chimney_major" id="chimney_major">
                  <option value="">Select</option>
                  <option value="1">1 ‚Äî Brick shell clay lined</option>
                  <option value="2">2 ‚Äî Brick shell unlined</option>
                  <option value="3">3 ‚Äî Bracket type</option>
                  <option value="4">4 ‚Äî Brick shell S.S. liner</option>
                  <option value="5">5 ‚Äî Metal not approved for wood</option>
                  <option value="6">6 ‚Äî ULC Metal approved for wood</option>
                  <option value="7">7 ‚Äî Pellet vent pipe</option>
                  <option value="8">8 ‚Äî Side vent</option>
                </select>
                <select name="chimney_minor" id="chimney_minor">
                  <option value="1">1 - Inside</option>
                  <option value="2">2 - Outside</option>
                </select>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <table class="materials-table">
        <thead>
          <tr>
            <th>Own/Shared</th>
            <th>Chimney Condition</th>
            <th>Shielding</th>
            <th>Flue Pipe Type</th>
            <th>Label</th>
            <th>Location</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-label="Own/Shared"><select id="own_shared" name="own_shared">
                <option value="own">Own</option>
                <option value="shared">Shared</option>
              </select>
            </td>
            <td data-label="Chimney Condition"><select id="chimney_condition" name="chimney_condition">
              <option value="1 - Very Good">1 - Very good</option>
              <option value="2 - Good">2 - Good</option>
              <option value="3 - Average" selected>3 - Average</option>
                <option value="4 - Poor">4 - Poor</option>
                <option value="5 - Very Poor">5 - Very poor</option>
                <option value="6 - Notify Underwriting">6 - Notify Underwriting</option>
              </select>
            </td>
            <td data-label="Shielding"><select name="shielding" id="shielding">
              <option value="No">No</option>
              <option value="Yes">Yes</option>
            </select>
            </td>
            <td data-label="Flue Pipe Type"><select name="flue_pipe_type" id="flue_pipe_type">
              <option value="" selected>N/A</option>
              <option value="SW">SW - Single Wall (18")</option>
              <option value="DW">DW - Double Wall (6")</option>
            </select>
            </td>
            <td data-label="Label"><select name="label" id="label">
              <option value="">Select</option>
              <option value="CSA B366">CSA B366</option>
              <option value="ULC S610">ULC S610</option>
              <option value="ULC S627">ULC S627</option>
              <option value="ULC S628">ULC S628</option>
              <option value="Other">Other</option>
              <option value="Not Labelled">Not labelled</option>
            </select>
            </td>
            <td data-label="Location">
              <select name="location" id="location">
                <option value="">Select</option>
                <option value="Dwelling">Dwelling</option>
                <option value="Garage attached/detached">Garage attached/detached</option>
                <option value="Outbuilding">Outbuilding</option>
                <option value="Outside">Other</option>
                <option value="Barn">Barn</option>
                <option value="Other">Other</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <section>
        <h2>Measurements & Clearances</h2>
      <table id="clearancesTable">
        <thead>
          <tr>
            <th>Clearances from</th>
            <th>Required</th>
            <th>Actual</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Top</td>
            <td><input type="number" name="clear_top_required"></td>
            <td><input type="number" name="clear_top_actual"></td>
          </tr>
          <tr>
            <td>Rear</td>
            <td><input type="number" name="clear_rear_required"></td>
            <td><input type="number" name="clear_rear_actual"></td>
          </tr>
          <tr>
            <td>Left side</td>
            <td><input type="number" name="clear_left_required"></td>
            <td><input type="number" name="clear_left_actual"></td>
          </tr>
          <tr>
            <td>Right side</td>
            <td><input type="number" name="clear_right_required"></td>
            <td><input type="number" name="clear_right_actual"></td>
          </tr>
          <tr>
            <td>Front</td>
            <td><input type="number" name="clear_front_required"></td>
            <td><input type="number" name="clear_front_actual"></td>
          </tr>
          <tr>
            <td>Flue pipe back</td>
            <td><input type="number" name="flue_pipe_back_required"></td>
            <td><input type="number" name="flue_pipe_back_actual"></td>
          </tr>
          <tr>
            <td>Flue pipe side</td>
            <td><input type="number" name="flue_pipe_side_required"></td>
            <td><input type="number" name="flue_pipe_side_actual"></td>
          </tr>
          <tr>
            <td>Flue pipe ceiling</td>
            <td><input type="number" name="flue_pipe_ceiling_required"></td>
            <td><input type="number" name="flue_pipe_ceiling_actual"></td>
          </tr>
          <tr>
            <td>Left corner</td>
            <td><input type="number" name="left_corner_required"></td>
            <td><input type="number" name="left_corner_actual"></td>
          </tr>
          <tr>
            <td>Right corner</td>
            <td><input type="number" name="right_corner_required"></td>
            <td><input type="number" name="right_corner_actual"></td>
          </tr>
          <tr>
            <td>Plenum</td>
            <td><input type="number" name="plenum_required"></td>
            <td><input type="number" name="plenum_actual"></td>
          </tr>
          <tr>
            <td>Mantel</td>
            <td><input type="number" name="mantel_required"></td>
            <td><input type="number" name="mantel_actual"></td>
          </tr>
          <tr>
            <td class="floor-pad" colspan="3">Floor Pad</td>
          </tr>
          <tr>
            <td>Fuel loading door</td>
            <td><input type="number" name="fuel_loading_door_required" value="18"></td>
            <td><input type="number" name="fuel_loading_door_actual"></td>
          </tr>
          <tr>
            <td>Left</td>
            <td><input type="number" name="left_required" value="8"></td>
            <td><input type="number" name="left_actual"></td>
          </tr>
          <tr>
            <td>Right</td>
            <td><input type="number" name="right_required" value="8"></td>
            <td><input type="number" name="right_actual"></td>
          </tr>
          <tr>
            <td>Rear</td>
            <td><input type="number" name="rear_required" value="8"></td>
            <td><input type="number" name="rear_actual"></td>
          </tr>
        </tbody>
      </table>
    </section>

        <section>
          <h2>Notes</h2>
          <textarea name="remarks" rows="5"></textarea>
        </section>
      </div>
    </div>

    <div id="buttonsContainer">
      <div style="margin:10px 0; text-align:left;">
        <button type="button" id="addAnotherBtn">Add Another Appliance</button>
        <span id="savedCount" style="margin-left:8px;color:#333;font-weight:600"></span>
      </div>

      <div class="actions">
        <button type="button" id="shareBtn">Save</button>
        <button type="button" id="previewBtn">Preview PDF</button>
        <button type="button" id="resetBtn">Reset</button>
      </div>
    </div>

  </form>

  <!-- Reset confirmation modal -->
  <div id="resetModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <p>Are you sure you want to reset the form? This will clear all entered data.</p>
      <div class="modal-actions">
        <button id="confirmReset" class="danger">Reset</button>
        <button id="cancelReset">Cancel</button>
      </div>
    </div>
  </div>

  <!-- PDF Preview modal -->
  <div id="previewModal" class="modal" aria-hidden="true">
    <div class="modal-content" style="width:90%; max-width:980px; height:80vh; display:flex; flex-direction:column;">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
        <h3 style="margin:0">PDF Preview</h3>
        <div>
          <button id="downloadPreviewBtn" type="button">Download</button>
          <button id="closePreviewBtn" type="button">Close</button>
        </div>
      </div>
      <div style="flex:1; margin-top:8px; overflow:hidden;">
        <iframe id="previewFrame" style="width:100%; height:100%; border:0;" title="PDF Preview"></iframe>
      </div>
    </div>
  </div>

  <!-- Info/Help modal -->
  <div id="infoModal" class="modal" aria-hidden="true">
    <div class="modal-content info-modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <h2 style="margin:0">Wood App Help & Information</h2>
        <button id="closeInfoBtn" type="button" style="padding:8px 16px;">Close</button>
      </div>
      <div id="infoContent" class="info-content">
        <!-- Content will be loaded from README.md -->
      </div>
    </div>
  </div>

  <!-- PDF Guide modal -->
  <div id="guideModal" class="modal" aria-hidden="true">
    <div class="modal-content guide-modal-content" style="width:95%; max-width:1100px; height:90vh; display:flex; flex-direction:column; padding:12px;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; flex-wrap:wrap; gap:8px;">
        <h3 style="margin:0">Wood Heat Guide</h3>
        <div style="display:flex; gap:8px;">
          <button id="downloadGuideBtn" type="button" style="padding:8px 16px;">Download</button>
          <button id="closeGuideBtn" type="button" style="padding:8px 16px;">Close</button>
        </div>
      </div>
      <div id="pdfViewerContainer" style="flex:1; overflow-y:auto; overflow-x:hidden; background:#525659; padding:10px; border-radius:4px;">
        <iframe id="guideFrame" style="width:100%; height:100%; border:1px solid #ccc; border-radius:4px; background:white; display:block;" title="Wood Heat Guide"></iframe>
        <div id="pdfCanvasContainer" style="display:none;"></div>
      </div>
      <p class="mobile-pdf-hint" style="display:none; margin-top:8px; text-align:center; font-size:0.9em; color:#666;">Scroll to view all pages</p>
    </div>
  </div>

  <!-- PDF.js library for iOS PWA support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // Set PDF.js worker
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
  
  <!-- jsPDF for client-side PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <link rel="manifest" href="manifest.json">
  <!-- Apple touch icon (optional) -->
  <link rel="icon" type="image/png" sizes="192x192" href="woodicon.png">
  <link rel="apple-touch-icon" href="woodicon.png">
  <script src="script.js"></script>
</body>
</html>